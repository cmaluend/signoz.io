---
date: 2026-02-13
id: tracing
title: Cloud Functions OpenTelemetry Tracing
description: Send traces from Google Cloud Functions to SigNoz Cloud using OpenTelemetry with a dedicated tracing.js setup file.
doc_type: howto
---

This guide shows you how to send traces from a Google Cloud Function to SigNoz using OpenTelemetry. You will set up OpenTelemetry once in `tracing.js`, import it in `index.js`, and create one custom span to verify end-to-end tracing.

<KeyPointCallout title="Using self-hosted SigNoz?" defaultCollapsed={true}>
Most steps are identical. To adapt this guide, update the endpoint and remove the ingestion key header as shown in [Cloud to Self-Hosted](https://signoz.io/docs/ingestion/cloud-vs-self-hosted/#cloud-to-self-hosted).
</KeyPointCallout>

## Prerequisites

- A Google Cloud project with billing enabled.
- Cloud Functions API enabled in your project.
- A 2nd gen Cloud Function using Node.js 20.
- A SigNoz Cloud account or self-hosted SigNoz instance.

## Send traces to SigNoz

### Step 1. Create an HTTP Cloud Function

In Google Cloud Console:

1. Open **Cloud Functions** and click **Create function**.
2. Select **2nd gen**.
3. Set **Runtime** to **Node.js 20**.
4. Set **Trigger** to **HTTP**.

You will add runtime environment variables and code in the next steps.

### Step 2. Configure OpenTelemetry environment variables

In **Runtime, build, connections and security settings** -> **Runtime environment variables**, add:

- `OTEL_EXPORTER_OTLP_TRACES_ENDPOINT=https://ingest.<region>.signoz.cloud/v1/traces`
- `OTEL_EXPORTER_OTLP_HEADERS=signoz-ingestion-key=<your-ingestion-key>`
- `OTEL_SERVICE_NAME=<your-service-name>`
- `OTEL_SERVICE_NAMESPACE=<your-team-or-system>` (optional)
- `OTEL_SERVICE_VERSION=<release-version>` (optional)
- `OTEL_DEPLOYMENT_ENVIRONMENT=production` (deployment tier, for example: `production`, `staging`, `dev`, `local`)

Verify these values:

- `<region>`: your SigNoz Cloud region (`us`, `eu`, or `in`). See https://signoz.io/docs/ingestion/signoz-cloud/overview/#endpoint
- `<your-ingestion-key>`: your SigNoz Cloud ingestion key.
- `<your-service-name>`: name that will appear in SigNoz Services (for example, `gcp-fn-orders`).
- `<your-team-or-system>`: optional group for related services (for example, `payments`).
- `<release-version>`: optional version label (for example, `1.12.3` or a git SHA).

### Step 3. Install the required packages

Run this in your Cloud Function project directory:

```bash
npm install --save \
  @google-cloud/functions-framework \
  @google-cloud/opentelemetry-cloud-trace-propagator \
  @opentelemetry/api \
  @opentelemetry/core \
  @opentelemetry/exporter-trace-otlp-http \
  @opentelemetry/resource-detector-gcp \
  @opentelemetry/resources \
  @opentelemetry/sdk-node \
  @opentelemetry/semantic-conventions
```

This creates or updates `package.json` and `package-lock.json` with the dependencies used by the examples in this guide.

<Admonition type="info">
Version check (verified on February 13, 2026): this guide was tested with Node.js 20 and the package versions currently published on npm at that time, including `@opentelemetry/sdk-node@0.212.0`, `@opentelemetry/core@2.5.1`, `@opentelemetry/resources@2.5.1`, `@opentelemetry/semantic-conventions@1.39.0`, `@google-cloud/functions-framework@5.0.1`, `@google-cloud/opentelemetry-cloud-trace-propagator@0.21.0`, and `@opentelemetry/resource-detector-gcp@0.46.0`.

OpenTelemetry JS recommends using matching `latest` packages together and provides a compatibility matrix here: https://github.com/open-telemetry/opentelemetry-js#package-version-compatibility
</Admonition>

### Step 4. Create `tracing.js`

Create a new file named `tracing.js` in your function source. This initializes the OpenTelemetry Node SDK, OTLP exporter, and GCP resource detection.

```js:tracing.js
'use strict';

const { NodeSDK } = require('@opentelemetry/sdk-node');
const {
  CompositePropagator,
  W3CBaggagePropagator,
  W3CTraceContextPropagator,
} = require('@opentelemetry/core');
const { CloudPropagator } = require('@google-cloud/opentelemetry-cloud-trace-propagator');
const { gcpDetector } = require('@opentelemetry/resource-detector-gcp');
const { OTLPTraceExporter } = require('@opentelemetry/exporter-trace-otlp-http');
const { resourceFromAttributes } = require('@opentelemetry/resources');
const {
  ATTR_SERVICE_NAME,
  ATTR_SERVICE_NAMESPACE,
  ATTR_SERVICE_VERSION,
} = require('@opentelemetry/semantic-conventions');
const { ATTR_DEPLOYMENT_ENVIRONMENT_NAME } = require('@opentelemetry/semantic-conventions/incubating');

const functionId = process.env.FUNCTION_ID || 'A';
const deploymentEnvironment =
  process.env.OTEL_DEPLOYMENT_ENVIRONMENT || process.env.DEPLOYMENT_ENVIRONMENT || 'local';

const resourceAttributes = {
  [ATTR_SERVICE_NAME]: process.env.OTEL_SERVICE_NAME || `function-${functionId.toLowerCase()}`,
  [ATTR_DEPLOYMENT_ENVIRONMENT_NAME]: deploymentEnvironment,
};

if (process.env.OTEL_SERVICE_NAMESPACE) {
  resourceAttributes[ATTR_SERVICE_NAMESPACE] = process.env.OTEL_SERVICE_NAMESPACE;
}

if (process.env.OTEL_SERVICE_VERSION) {
  resourceAttributes[ATTR_SERVICE_VERSION] = process.env.OTEL_SERVICE_VERSION;
}

const textMapPropagator = new CompositePropagator({
  propagators: [
    new W3CTraceContextPropagator(),
    new CloudPropagator(),
    new W3CBaggagePropagator(),
  ],
});

const sdk = new NodeSDK({
  resource: resourceFromAttributes(resourceAttributes),
  autoDetectResources: true,
  resourceDetectors: [gcpDetector],
  traceExporter: new OTLPTraceExporter(),
  textMapPropagator,
});

(async () => {
  try {
    await sdk.start();
  } catch (err) {
    console.error('Error starting OTel SDK', err);
  }
})();

async function shutdownAndExit(exitCode) {
  try {
    await sdk.shutdown();
    process.exit(exitCode);
  } catch (err) {
    console.error('Error shutting down OTel SDK', err);
    process.exit(1);
  }
}

process.on('SIGTERM', () => shutdownAndExit(0));
process.on('SIGINT', () => shutdownAndExit(0));

module.exports = { sdk };
```

### Step 5. Update `index.js` with one small trace

Import `tracing.js` first, then create one active span inside your HTTP handler:

```js:index.js
'use strict';

require('./tracing');

const functions = require('@google-cloud/functions-framework');
const { context, propagation, ROOT_CONTEXT, trace } = require('@opentelemetry/api');

const tracer = trace.getTracer('gcp-function-tracer');

functions.http('entryPoint', async (req, res) => {
  const extractedContext = propagation.extract(ROOT_CONTEXT, req.headers);

  await context.with(extractedContext, async () => {
    await tracer.startActiveSpan('entryPoint.handler', async (span) => {
      try {
        span.setAttribute('function.name', process.env.K_SERVICE || 'entryPoint');

        res.status(200).json({
          ok: true,
          message: req.query.message || 'Hello from Cloud Functions',
        });
      } catch (err) {
        span.recordException(err);
        span.setStatus({ code: 2, message: err.message });
        res.status(500).json({ ok: false, error: err.message });
      } finally {
        span.end();
      }
    });
  });
});
```

What this does:

- `require('./tracing')` starts the OpenTelemetry SDK before your handler runs.
- `startActiveSpan` creates one custom span: `entryPoint.handler`.
- `propagation.extract(...)` links this span to upstream traces when trace headers are present.

### Step 6. Deploy and invoke the function

1. Deploy the function.
2. Copy the HTTPS trigger URL after deployment.
3. Invoke it once:

```bash
curl "https://<your-cloud-function-url>?message=hello-signoz"
```

## Validate

<Admonition type="info">
If your trace looks like it is missing the first (root) span in SigNoz, you're not doing anything wrong. This is expected on GCP-managed serverless entrypoints.

Cloud Run/Cloud Functions can generate the incoming request trace context at the platform layer and pass only the trace headers (like `traceparent` or `X-Cloud-Trace-Context`) to your function. Your function can continue that trace using `propagation.extract(...)`, but the platform-generated root span itself remains in Cloud Trace and is not sent by your app exporter to SigNoz.

In practice, this can show up as:

- A missing root span in SigNoz for some requests.
- Partial service maps when the upstream/root service exists only in Cloud Trace data.
</Admonition>

After invoking the function, verify traces in SigNoz:

1. Open SigNoz and go to **Services**.
2. Find the service name you set in `OTEL_SERVICE_NAME`.
3. Open **Traces** and filter by `service.name=<your-service-name>`.
4. Open a trace and confirm the span `entryPoint.handler` is present.

<details>
<ToggleHeading>
## Setup OpenTelemetry Collector (Optional)
</ToggleHeading>

### What is the OpenTelemetry Collector?

The OTel Collector acts as a middleman between your app and SigNoz. Instead of sending data directly, your application sends everything to the Collector first, which then forwards it along.

### Why use it?

- **Cleaning up data** — Filter out noisy traces you don't care about, or remove sensitive info before it leaves your servers.
- **Keeping your app lightweight** — Let the Collector handle batching, retries, and compression instead of your application code.
- **Adding context automatically** — The Collector can tag your data with useful info like which Kubernetes pod or cloud region it came from.
- **Future flexibility** — Want to send data to multiple backends later? The Collector makes that easy without changing your app.

See [Switch from direct export to Collector](https://signoz.io/docs/opentelemetry-collection-agents/opentelemetry-collector/switch-to-collector/) for step-by-step instructions.

</details>

<details>
<ToggleHeading>
## Troubleshooting
</ToggleHeading>

### Why don't traces appear in SigNoz?

- Check that `OTEL_EXPORTER_OTLP_TRACES_ENDPOINT` includes `/v1/traces`.
- Check that `OTEL_EXPORTER_OTLP_HEADERS` is exactly `signoz-ingestion-key=<your-ingestion-key>`.
- Check Cloud Function logs for `Error starting OTel SDK`.
- Invoke the function a few times; cold starts can delay the first export.

### Why do I see 401/403 from the SigNoz endpoint?

Your ingestion key is incorrect or missing. Recopy it from https://signoz.io/docs/ingestion/signoz-cloud/keys/ and redeploy.

### Why is my service missing from the Services list?

Set `OTEL_SERVICE_NAME` to a stable value, redeploy, and invoke again. If unset, the fallback name is `gcp-cloud-function`.

</details>

## Next steps

- Correlate traces with logs: https://signoz.io/docs/traces-management/guides/correlate-traces-and-logs/
- Create trace-based alerts: https://signoz.io/docs/alerts-management/
- Build dashboards for latency and errors: https://signoz.io/docs/userguide/manage-dashboards/
