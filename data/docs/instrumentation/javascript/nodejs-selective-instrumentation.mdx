---
date: 2026-01-27
id: nodejs-selective-instrumentation
title: Selective Auto-Instrumentation
description: Control which libraries are automatically instrumented in Node.js using environment variables or code
tags: [SigNoz Cloud, Self-Host]
doc_type: howto
---

import GetHelp from '@/components/shared/get-help.md'

Auto-instrumentation enables many libraries by default. Use environment variables or code to enable only what you need.

<KeyPointCallout title="Works for both SigNoz Cloud and Self-Hosted" defaultCollapsed="true">
These steps work the same way regardless of deployment. Only your OTLP endpoint and ingestion key differ.
</KeyPointCallout>

## Prerequisites

- Node.js 18+ application instrumented with OpenTelemetry (see [Node.js instrumentation guide](https://signoz.io/docs/instrumentation/javascript/opentelemetry-nodejs/))
- OpenTelemetry SDK installed and configured

## Configure selective instrumentation

<Tabs>
<TabItem value="no-code" label="No Code" default>

No code changes required. Configure using environment variables.

### Enable or disable specific libraries

```bash
# Enable only HTTP and Express
export OTEL_NODE_ENABLED_INSTRUMENTATIONS="http,express"

# Disable file system and gRPC
export OTEL_NODE_DISABLED_INSTRUMENTATIONS="fs,grpc"
```

Use library names without the `@opentelemetry/instrumentation-` prefix. See the [full list of supported libraries](https://github.com/open-telemetry/opentelemetry-js-contrib/blob/main/packages/auto-instrumentations-node/README.md#supported-instrumentations).

<Admonition>
If both variables are set, `OTEL_NODE_ENABLED_INSTRUMENTATIONS` applies first, then `OTEL_NODE_DISABLED_INSTRUMENTATIONS`. A library in both lists will be disabled.
</Admonition>

### Run your application

```bash
export OTEL_TRACES_EXPORTER="otlp"
export OTEL_EXPORTER_OTLP_ENDPOINT="https://ingest.<region>.signoz.cloud:443"
export OTEL_EXPORTER_OTLP_HEADERS="signoz-ingestion-key=<your-ingestion-key>"
export OTEL_SERVICE_NAME="<service-name>"
export OTEL_NODE_RESOURCE_DETECTORS="env,host,os"
export OTEL_NODE_ENABLED_INSTRUMENTATIONS="http,express"
export NODE_OPTIONS="--require @opentelemetry/auto-instrumentations-node/register"
node app.js
```

Replace `<service-name>` with your value.
- `<region>`: Your [SigNoz Cloud region](https://signoz.io/docs/ingestion/signoz-cloud/overview/#endpoint).
- `<your-ingestion-key>`: Your SigNoz [ingestion key](https://signoz.io/docs/ingestion/signoz-cloud/keys/)

<Admonition>
Environment variables only work with no-code auto-instrumentation (`NODE_OPTIONS="--require @opentelemetry/auto-instrumentations-node/register"`). For code-based setup, use the Code-based tab.
</Admonition>

</TabItem>
<TabItem value="code-level" label="Code Level">

Configure instrumentations directly in your setup file.

### Update your instrumentation file

```javascript:instrumentation.js
const { NodeSDK } = require('@opentelemetry/sdk-node')
const { OTLPTraceExporter } = require('@opentelemetry/exporter-trace-otlp-http')
const { getNodeAutoInstrumentations } = require('@opentelemetry/auto-instrumentations-node')

const instrumentations = getNodeAutoInstrumentations({
  '@opentelemetry/instrumentation-fs': { enabled: false },
  '@opentelemetry/instrumentation-http': { enabled: true },
  '@opentelemetry/instrumentation-express': { enabled: true },
  '@opentelemetry/instrumentation-dns': { enabled: false },
  '@opentelemetry/instrumentation-grpc': { enabled: false },
})

const sdk = new NodeSDK({
  traceExporter: new OTLPTraceExporter({
    url: 'https://ingest.<region>.signoz.cloud:443/v1/traces',
    headers: { 'signoz-ingestion-key': '<your-ingestion-key>' }
  }),
  instrumentations: [instrumentations],
})

sdk.start()
```

- `<region>`: Your [SigNoz Cloud region](https://signoz.io/docs/ingestion/signoz-cloud/overview/#endpoint).
- `<your-ingestion-key>`: Your SigNoz [ingestion key](https://signoz.io/docs/ingestion/signoz-cloud/keys/)

### Run your application

```bash
node -r ./instrumentation.js app.js
```

</TabItem>
</Tabs>

## Validate

Enable debug logging to verify which instrumentations are active:

```bash
export OTEL_LOG_LEVEL=debug
```

Check the output for lines showing which instrumentations loaded.

<details>
<ToggleHeading>

## Troubleshooting

</ToggleHeading>

### No traces appearing in SigNoz

- Verify `OTEL_EXPORTER_OTLP_ENDPOINT` and `OTEL_EXPORTER_OTLP_HEADERS` are set correctly.
- Check network connectivity to the SigNoz endpoint.

### Missing or incomplete spans

- Confirm the instrumentation library is enabled via `OTEL_NODE_ENABLED_INSTRUMENTATIONS`.
- For no-code setup, ensure `NODE_OPTIONS="--require @opentelemetry/auto-instrumentations-node/register"` is set.

### Invalid ingestion key

- Format should be: `signoz-ingestion-key=<your-ingestion-key>`
- Check for extra spaces or quotes.

</details>

## Next steps

- [Manual instrumentation](https://signoz.io/docs/instrumentation/javascript/nodejs-manual-instrumentation/) to add custom spans
- [Node.js instrumentation guide](https://signoz.io/docs/instrumentation/javascript/opentelemetry-nodejs/) for full setup

<GetHelp />
