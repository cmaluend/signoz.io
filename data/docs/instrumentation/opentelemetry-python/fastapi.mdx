---
date: 2025-12-11
id: fastapi
title: FastAPI OpenTelemetry Instrumentation
description: Learn how to instrument your FastAPI application with OpenTelemetry and send traces to SigNoz
tags: [SigNoz Cloud, Self-Host]
doc_type: howto
---

This guide shows you how to instrument your FastAPI application with OpenTelemetry and send traces to SigNoz. FastAPI's async-first design works seamlessly with OpenTelemetry's automatic instrumentation, requiring minimal code changes.

<KeyPointCallout title="Using self-hosted SigNoz?" defaultCollapsed={true}>
Most steps are identical. To adapt this guide, update the endpoint and remove the ingestion key header as shown in [Cloud to Self-Hosted](https://signoz.io/docs/ingestion/cloud-vs-self-hosted/#cloud-to-self-hosted).
</KeyPointCallout>

## Prerequisites

- Python 3.8 or later
- A FastAPI application
- A SigNoz Cloud account or self-hosted SigNoz instance

## Send traces to SigNoz

<Tabs entityName="deployment">
<TabItem value="vm" label="VM" default>
<KeyPointCallout title="What classifies as VM?" defaultCollapsed={true}>
A VM is a virtual computer that runs on physical hardware. This includes:
- **Cloud VMs**: AWS EC2, Google Compute Engine, Azure VMs, DigitalOcean Droplets
- **On-premise VMs**: VMware, VirtualBox, Hyper-V, KVM
- **Bare metal servers**: Physical servers running Linux/Unix directly

Use this section if you're deploying your FastAPI application directly on a server or VM without containerization.
</KeyPointCallout>

### Step 1. Set environment variables

Set the following environment variables to configure the OpenTelemetry exporter:

```bash
export OTEL_RESOURCE_ATTRIBUTES="service.name=<service-name>"
export OTEL_EXPORTER_OTLP_ENDPOINT="https://ingest.<region>.signoz.cloud:443"
export OTEL_EXPORTER_OTLP_HEADERS="signoz-ingestion-key=<your-ingestion-key>"
export OTEL_EXPORTER_OTLP_PROTOCOL="grpc"
```

Replace the following:
- `<region>`: Your SigNoz Cloud region (`us`, `eu`, or `in`). See [endpoints](https://signoz.io/docs/ingestion/signoz-cloud/overview/#endpoint).
- `<your-ingestion-key>`: Your SigNoz [ingestion key](https://signoz.io/docs/ingestion/signoz-cloud/keys/).
- `<service-name>`: A descriptive name for your service (e.g., `fastapi-app`).

### Step 2. Install OpenTelemetry packages

```bash
pip install opentelemetry-distro opentelemetry-exporter-otlp
```

Then run the bootstrap command to install instrumentation libraries for your dependencies:

```bash
opentelemetry-bootstrap --action=install
```

<Admonition>
Run `opentelemetry-bootstrap` after installing your application dependencies. The command detects installed packages and adds the corresponding instrumentation libraries.
</Admonition>

### Step 3. Run with opentelemetry-instrument

Start your FastAPI application with the OpenTelemetry wrapper:

```bash
opentelemetry-instrument uvicorn main:app --host 0.0.0.0 --port 8000 --no-reload
```

<Admonition type="warning">
Always use `--no-reload` when running with OpenTelemetry instrumentation. Uvicorn's reload mode spawns new processes that break the instrumentation setup. For development without tracing, you can omit the `opentelemetry-instrument` wrapper entirely.
</Admonition>

</TabItem>

<TabItem value="k8s" label="Kubernetes">

### Step 1. Set environment variables

Add these environment variables to your deployment manifest:

```yaml
env:
- name: OTEL_RESOURCE_ATTRIBUTES
  value: 'service.name=<service-name>'
- name: OTEL_EXPORTER_OTLP_ENDPOINT
  value: 'https://ingest.<region>.signoz.cloud:443'
- name: OTEL_EXPORTER_OTLP_HEADERS
  value: 'signoz-ingestion-key=<your-ingestion-key>'
- name: OTEL_EXPORTER_OTLP_PROTOCOL
  value: 'grpc'
```

Replace the following:
- `<region>`: Your SigNoz Cloud region (`us`, `eu`, or `in`). See [endpoints](https://signoz.io/docs/ingestion/signoz-cloud/overview/#endpoint).
- `<your-ingestion-key>`: Your SigNoz [ingestion key](https://signoz.io/docs/ingestion/signoz-cloud/keys/).
- `<service-name>`: A descriptive name for your service (e.g., `fastapi-app`).

### Step 2. Install OpenTelemetry packages

Add to your `requirements.txt`:

```text
opentelemetry-distro
opentelemetry-exporter-otlp
```

Update your Dockerfile to run bootstrap and use the instrumentation wrapper:

```dockerfile:Dockerfile
FROM python:3.11-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt
RUN opentelemetry-bootstrap --action=install

COPY . .

CMD ["opentelemetry-instrument", "uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
```

### Step 3. Deploy your application

Apply your Kubernetes deployment:

```bash
kubectl apply -f deployment.yaml
```

</TabItem>

<TabItem value="windows" label="Windows">

### Step 1. Set environment variables (PowerShell)

```powershell
$env:OTEL_RESOURCE_ATTRIBUTES = "service.name=<service-name>"
$env:OTEL_EXPORTER_OTLP_ENDPOINT = "https://ingest.<region>.signoz.cloud:443"
$env:OTEL_EXPORTER_OTLP_HEADERS = "signoz-ingestion-key=<your-ingestion-key>"
$env:OTEL_EXPORTER_OTLP_PROTOCOL = "grpc"
```

Replace the following:
- `<region>`: Your SigNoz Cloud region (`us`, `eu`, or `in`).
- `<your-ingestion-key>`: Your SigNoz [ingestion key](https://signoz.io/docs/ingestion/signoz-cloud/keys/).
- `<service-name>`: A descriptive name for your service.

### Step 2. Install OpenTelemetry packages

```powershell
pip install opentelemetry-distro opentelemetry-exporter-otlp
opentelemetry-bootstrap --action=install
```

### Step 3. Run with opentelemetry-instrument

```powershell
opentelemetry-instrument uvicorn main:app --host 0.0.0.0 --port 8000 --no-reload
```

</TabItem>

<TabItem value="docker" label="Docker">

### Step 1. Set environment variables in Dockerfile

```dockerfile:Dockerfile
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Install OpenTelemetry packages
RUN pip install opentelemetry-distro opentelemetry-exporter-otlp
RUN opentelemetry-bootstrap --action=install

COPY . .

# Set OpenTelemetry environment variables
ENV OTEL_RESOURCE_ATTRIBUTES="service.name=<service-name>"
ENV OTEL_EXPORTER_OTLP_ENDPOINT="https://ingest.<region>.signoz.cloud:443"
ENV OTEL_EXPORTER_OTLP_HEADERS="signoz-ingestion-key=<your-ingestion-key>"
ENV OTEL_EXPORTER_OTLP_PROTOCOL="grpc"

EXPOSE 8000

CMD ["opentelemetry-instrument", "uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
```

Or pass environment variables at runtime using `docker run`:

```bash
docker run -e OTEL_RESOURCE_ATTRIBUTES="service.name=<service-name>" \
    -e OTEL_EXPORTER_OTLP_ENDPOINT="https://ingest.<region>.signoz.cloud:443" \
    -e OTEL_EXPORTER_OTLP_HEADERS="signoz-ingestion-key=<your-ingestion-key>" \
    -e OTEL_EXPORTER_OTLP_PROTOCOL="grpc" \
    -p 8000:8000 \
    your-image:latest
```

Replace the following:
- `<region>`: Your SigNoz Cloud region (`us`, `eu`, or `in`). See [endpoints](https://signoz.io/docs/ingestion/signoz-cloud/overview/#endpoint).
- `<your-ingestion-key>`: Your SigNoz [ingestion key](https://signoz.io/docs/ingestion/signoz-cloud/keys/).
- `<service-name>`: A descriptive name for your service (e.g., `fastapi-app`).

</TabItem>
</Tabs>

## Running with Gunicorn

For production deployments using Gunicorn with uvicorn workers, you need to configure a post-fork hook to reinitialize the tracer in each worker process.

Create a `gunicorn.conf.py` file:

```python:gunicorn.conf.py
from opentelemetry import trace
from opentelemetry.exporter.otlp.proto.grpc.trace_exporter import OTLPSpanExporter
from opentelemetry.sdk.trace import TracerProvider
from opentelemetry.sdk.trace.export import BatchSpanProcessor

def post_fork(server, worker):
    provider = TracerProvider()
    processor = BatchSpanProcessor(OTLPSpanExporter())
    provider.add_span_processor(processor)
    trace.set_tracer_provider(provider)
```

Run Gunicorn with the configuration:

```bash
opentelemetry-instrument gunicorn main:app -c gunicorn.conf.py -k uvicorn.workers.UvicornWorker --workers 4
```

See the [OpenTelemetry fork process documentation](https://opentelemetry-python.readthedocs.io/en/latest/examples/fork-process-model/README.html) for details on instrumenting pre-fork servers.

## Validate

After running your instrumented application, verify traces appear in SigNoz:

1. Generate some traffic by making requests to your FastAPI endpoints.
2. Open SigNoz and navigate to **Services**.
3. Click **Refresh** and look for your service name in the list.
4. Navigate to **Traces** to view detailed span information.

<details>
<ToggleHeading>
## Troubleshooting
</ToggleHeading>

### Why don't traces appear in SigNoz?

**Check environment variables are set:**

```bash
echo $OTEL_EXPORTER_OTLP_ENDPOINT
echo $OTEL_RESOURCE_ATTRIBUTES
```

**Enable console exporter for debugging:**

```bash
OTEL_TRACES_EXPORTER=console opentelemetry-instrument uvicorn main:app --port 8000 --no-reload
```

This prints trace data to the console, helping verify instrumentation is working.

### Why do traces stop after reload?

Uvicorn's `--reload` flag creates new processes that bypass OpenTelemetry initialization. Always use `--no-reload` when running with `opentelemetry-instrument`.

### Why do OTLP exports fail with `connection refused`?

- **VM**: Verify the endpoint URL and that your firewall allows outbound HTTPS on port 443
- **Kubernetes**: Ensure the OTel Collector service is running and accessible
- **Self-hosted**: Confirm the collector is listening on the expected port (4317 for gRPC, 4318 for HTTP)

### Why don't database calls appear in traces?

Ensure your database client library is supported by OpenTelemetry. Run `opentelemetry-bootstrap --action=install` after installing dependencies like `psycopg2`, `pymongo`, or `redis`.

<Admonition>
Use `psycopg2` instead of `psycopg2-binary` for PostgreSQL instrumentation. The binary package is not supported by OpenTelemetry auto-instrumentation.
</Admonition>

</details>

<details>
<ToggleHeading>
## Setup OpenTelemetry Collector (Optional)
</ToggleHeading>

### What is the OpenTelemetry Collector?

Think of the OTel Collector as a middleman between your app and SigNoz. Instead of your application sending data directly to SigNoz, it sends everything to the Collector first, which then forwards it along.

### Why use it?

- **Cleaning up data** - Filter out noisy traces you don't care about, or remove sensitive info before it leaves your servers.
- **Keeping your app lightweight** - Let the Collector handle batching, retries, and compression instead of your application code.
- **Adding context automatically** - The Collector can tag your data with useful info like which Kubernetes pod or cloud region it came from.
- **Future flexibility** - Want to send data to multiple backends later? The Collector makes that easy without changing your app.

### Using the Collector

When using the Collector, update your environment variables to point to the local Collector:

```bash
export OTEL_EXPORTER_OTLP_ENDPOINT="http://localhost:4317"
```

See [Switch from direct export to Collector](https://signoz.io/docs/opentelemetry-collection-agents/opentelemetry-collector/switch-to-collector/) for step-by-step instructions to convert your setup.

For more details, see [Why use the OpenTelemetry Collector?](https://signoz.io/docs/opentelemetry-collection-agents/opentelemetry-collector/why-to-use-collector/) and the [Collector configuration guide](https://signoz.io/docs/opentelemetry-collection-agents/opentelemetry-collector/configuration/).

</details>

## Next steps

- [Correlate traces with logs](https://signoz.io/docs/traces-management/guides/correlate-traces-and-logs/) to accelerate debugging
- [Set up alerts](https://signoz.io/docs/alerts-management/notification-channel/slack/) for your FastAPI application
- [Create dashboards](https://signoz.io/docs/userguide/manage-dashboards/) to visualize metrics
- Explore [manual instrumentation](https://signoz.io/docs/instrumentation/opentelemetry-python/) for custom spans and attributes
