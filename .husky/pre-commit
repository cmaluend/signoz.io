#!/usr/bin/env sh
set -e

if [ "${HUSKY_SKIP_LINT:-}" = "1" ] || [ "${HUSKY_SKIP_LINT:-}" = "true" ]; then
  echo 'husky (pre-commit): skipping lint-staged because HUSKY_SKIP_LINT is set'
else
  echo 'husky (pre-commit): running lint-staged'
  yarn lint-staged
fi

STAGED_FILES=$(git diff --cached --name-only)

# Check for docs redirect changes
if printf '%s\n' "$STAGED_FILES" | grep -E '^(data/docs/.*\.mdx|next\.config\.js|scripts/check-doc-redirects\.js)$' >/dev/null; then
  echo 'husky (pre-commit): verifying docs redirects'
  yarn check:doc-redirects
else
  echo 'husky (pre-commit): skipping docs redirect check (no relevant changes staged)'
fi

# Check for docs metadata
if printf '%s\n' "$STAGED_FILES" | grep -E '^data/docs/.*\.mdx$' >/dev/null; then
  echo 'husky (pre-commit): validating docs metadata'
  HUSKY_PRE_COMMIT=true yarn check:docs-metadata
else
  echo 'husky (pre-commit): skipping docs metadata check (no documentation changes staged)'
fi
